db:
  image: mysql:5.7.7
  volumes:
    - './data:/var/lib/mysql'
  environment:
    MYSQL_ROOT_PASSWORD: mypass
redis:
  image: redis
web:
  build: .
  command: bash -c "bin/setup && rails server -b 0.0.0.0"
  ports:
    - "80:3000"
  volumes:
    - './:/opt/app'
  environment:
    SECRET_KEY_BASE: abcdefg
    RAILS_ENV: development
    MYSQL_ROOT_PASSWORD: mypass
    HOST_URL: localhost
  links:
    - db
    - redis
worker:
  build: .
  command: bash -c "bin/db-ready && bundle exec sidekiq -e development -c 25"
  volumes:
    - './:/opt/app'
  environment:
    SECRET_KEY_BASE: abcdefg
    RAILS_ENV: development
    MYSQL_ROOT_PASSWORD: mypass
    HOST_URL: localhost
  links:
    - db
    - redis
